<tool id="pathview_download.kegg" name="download.kegg" version="@VERSION@.0">
    <description>with pathview</description>
     <macros>
       <import>pathview_macros.xml</import>
    </macros>

    <requirements>
        <requirement type="package" version="@VERSION@">bioconductor-pathview</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        Rscript '$script'
    ]]></command>

    <configfiles>
        <configfile name="script"><![CDATA[
## Setup R error handling to go to stderr
options(show.error.messages=F, error=function(){cat(geterrmessage(),file=stderr());q("no",1,F)})
loc <- Sys.setlocale("LC_MESSAGES", "en_US.UTF-8")

## Import library
library(pathview)

pathway_id = "$pathway_id"
species = "$species"
file_type = "$file_type"

download.kegg(pathway.id = pathway_id, species = species, kegg.dir = ".", file.type= file_type)
]]>
        </configfile>
    </configfiles>
    <inputs>
        <param name="pathway_id" type="text" value="00010" label=" 5-digit KEGG pathway IDs" />
        <param name="species" type="text" value="hsa" label="KEGG code, the scientific name, or the common name of the target species" help="When KEGG ortholog pathway is considered, use ko. The default species is Homo sapiens (scientific name) or human (common name)" />
        <param name="file_type" type="select" label="Select the output type">
            <option value="xml">KEGG pathway data file (xml)</option>
            <option value="png" selected="true">Image file (png)</option>
        </param>
    </inputs>

    <outputs>
         <data name="png_output" format="png" label="${tool.name} on ${on_string}: png output">
            <filter>file_type == "png"</filter>
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" ext="png" visible="true" assign_primary_output="true" />
        </data>
        <data name="xml_output" format="xml" label="${tool.name} on ${on_string}: xml output">
            <filter>file_type == "xml"</filter>
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.xml" ext="xml" visible="true" assign_primary_output="true" />
        </data>
    </outputs>

    <tests>
        <test expect_num_outputs="1">
            <param name="pathway_id" value="04110" />
            <param name="species" value="hsa" />
            <param name="file_type" value="png" />
            <output name="png_output" value="download.kegg_png_output.png" />
        </test>
        <test expect_num_outputs="1">
            <param name="pathway_id" value="04110" />
            <param name="species" value="hsa" />
            <param name="file_type" value="xml" />
            <output name="png_output" value="download.kegg_xml_output.xml" />
        </test>
    </tests>

    <help><![CDATA[

Download KEGG pathways.

It returns:

- graph images and associated KGML data

    ]]></help>
    <expand macro="citations" />
</tool>